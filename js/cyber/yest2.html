<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>12-4-1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        p {
            text-align: center;
        }
        #canvas1 {
            border: 1px solid gray;
        }
    </style>
</head>
<body>
    <p><canvas id="canvas1" width="480" height="480"></canvas></p>

    <script>
        var canvas1 = document.getElementById("canvas1");
        var ctx1 = canvas1.getContext("2d");

        //変数の設定と初期化
        var target1 = {x:250, y:100, dir:1};
        var target2 = {x:250, y:100, dir:2};
        var target3 = {x:250, y:100, dir:4};
        var player = {x:250, y:400};
        var ball = {x:-10, y:-10};
        var point1 = 0;
        var point2 = 0;
        var point3 = 0;

        //一定時間毎起動させる
        setInterval(game1, 1);

        //game1関数
        function game1() {
            ctx1.clearRect(0, 0, 480, 480);

            //ターゲット1
            ctx1.fillStyle = "black";
            ctx1.fillRect(target1.x-20, target1.y-5, 70, 10);

            //ターゲット2
            ctx1.fillStyle = "green";
            ctx1.fillRect(target2.x-15, target2.y+100, 50, 10);

            //ターゲット3
            ctx1.fillStyle = "orange";
            ctx1.fillRect(target3.x, target3.y-40, 30, 10);

            //得点
            ctx1.fillStyle = "black";
            ctx1.font = "20px sans-serif";
            ctx1.fillText(point1, target1.x, target1.y-5);
            ctx1.fillText(point2, target2.x+5, target2.y+100);
            ctx1.fillText(point3, target3.x+5, target3.y-40);

            //プレーヤ
            ctx1.fillStyle = "blue";
            ctx1.fillRect(player.x-25, player.y-5, 100, 10);

            //描画（ボール）
            ctx1.fillStyle = "red";
            ctx1.beginPath();
            ctx1.arc(ball.x, ball.y, 10, 0, 2*Math.PI, false);
            ctx1.closePath();
            ctx1.fill();

            //移動計算
            target1.x += target1.dir;
            ball.y -= 5;

            target2.x += target2.dir;
            ball.y -= 5;

            target3.x += target3.dir;
            ball.y -= 5;

            //壁衝突計算
            if (target1.x < 25 || 440 < target1.x) {target1.dir *= -1;}

            if (target2.x < 25 || 440 < target2.x) {target2.dir *= -1;}

            if (target3.x < 25 || 440 < target3.x) {target3.dir *= -1;}

            //得点
            //ターゲット1
            if ((ball.y === 100) && (Math.abs(target1.x - ball.x) < 30)) {
                point1++;
            }
            //ターゲット2
            if ((ball.y === 100) && (Math.abs(target2.x - ball.x) < 30)) {
                point2++;
            }
            //ターゲット3
            if ((ball.y === 100) && (Math.abs(target3.x - ball.x) < 30)) {
                point3++;
            }
        }

        //シュート
        canvas1.addEventListener("mousedown", function() {
            ball.x = player.x;
            ball.y = player.y;
        });

        //playerコントロール
        canvas1.addEventListener("mousemove", function(e) {
            var rect = e.target.getBoundingClientRect();
            player.x = e.clientX-rect.left;
        });
    </script>
</body>
</html>